---
id: D0F1354B-B3C4-438D-AF70-2A51AB9D05E2
title: Migration Guide - MCP SDK 1.6.0 to 1.22.0
status: ✅ Completed
date: 2025-11-23
author: aRustyDev
related:
  - 2F7850D8-3E51-456C-AE60-C70BAF323BFB  # Plan: Streamable HTTP Implementation
---

# Migration Guide - MCP SDK 1.6.0 to 1.22.0

This guide covers the upgrade to MCP SDK 1.22.0 for Streamable HTTP support.

## Overview

**Upgrade:** MCP Python SDK 1.6.0 → 1.22.0
**Transport Change:** Legacy HTTP+SSE → Modern Streamable HTTP
**Breaking Changes:** Endpoint paths only (API unchanged)
**Effort:** Low (completed in ~6 hours)

---

## What Changed

### 1. Dependency Upgrade

**Before:**
```toml
dependencies = [
    "mcp[cli]>=1.2.0",  # Resolved to 1.6.0
]
```

**After:**
```toml
dependencies = [
    "mcp[cli]>=1.22.0",  # Latest with Streamable HTTP
]
```

### 2. Transport Change

**Before (Legacy HTTP+SSE):**
- Endpoint: `GET /sse` for SSE stream
- Endpoint: `POST /messages/<session_id>` for requests
- Protocol: 2024-11-05 specification
- Session ID: In URL path/query parameter

**After (Modern Streamable HTTP):**
- Endpoint: `/mcp` (unified for GET/POST/DELETE)
- Protocol: 2025-03-26 specification
- Session ID: In `Mcp-Session-Id` HTTP header
- Stateless operation for better scalability

### 3. Code Changes

**FastMCP Initialization:**
```python
# BEFORE (Legacy)
self.mcp = FastMCP(
    config.server_name,  # positional argument
    version=config.server_version,  # REMOVED in 1.22.0
    json_response=config.json_response,
)

# AFTER (Streamable HTTP)
self.mcp = FastMCP(
    name=config.server_name,  # Changed to keyword argument
    json_response=config.json_response,
    stateless_http=True,  # NEW: Enable stateless HTTP
)
```

**Health Check Integration:**
```python
# AFTER - Health check added as custom route
@self.mcp.custom_route(path="/health", methods=["GET"])
async def health_endpoint(request):
    return JSONResponse({
        "status": "healthy",
        "service": "zettelkasten-mcp",
        "transport": "streamable-http"
    })
```

**HTTP App Creation:**
```python
# BEFORE (Legacy HTTP+SSE)
sse_app = mcp_server.mcp.sse_app(
    sse_path="/sse",
    message_path="/messages/"
)

# AFTER (Streamable HTTP)
app = mcp_server.mcp.streamable_http_app()  # Single unified endpoint
```

### 4. Configuration Changes

**New Config Fields:**
```python
# config.py additions
stateless_http: bool = Field(
    default=os.getenv("ZETTELKASTEN_STATELESS_HTTP", "true").lower() == "true"
)
streamable_http_path: str = Field(
    default=os.getenv("ZETTELKASTEN_STREAMABLE_HTTP_PATH", "/mcp")
)
```

### 5. Client Configuration

**Zed Editor:**
```json
{
  "context_servers": {
    "zettelkasten": {
      "type": "http",
      "url": "http://localhost:8000/mcp"  // Changed from /sse
    }
  }
}
```

**For Docker/Traefik users:**
```json
{
  "context_servers": {
    "zettelkasten": {
      "type": "http",
      "url": "http://mcp.localhost/mcp"  // Using Traefik routing
    }
  }
}
```

**mcp-remote:**
```bash
# BEFORE
npx mcp-remote http://localhost:8000/sse

# AFTER
npx mcp-remote http://localhost:8000/mcp
```

---

## Backward Compatibility

### What Still Works ✅

- **STDIO transport:** Unchanged, fully compatible
- **All MCP tools:** No changes to tool definitions
- **All resources:** No changes to resource definitions
- **All prompts:** No changes to prompt definitions
- **Health endpoint:** Still at `/health` (unchanged)
- **Docker deployment:** Works after rebuilding with new code

### What Stopped Working ❌

- **Legacy HTTP+SSE:** `/sse` and `/messages/` endpoints removed
- **Old client configs:** Must update to use `/mcp` endpoint
- **FastMCP `version` parameter:** Removed from API

---

## Migration Steps

For users upgrading from previous version:

### 1. Update Client Configuration

**Zed users:** Update `~/.config/zed/settings.json`
```json
{
  "context_servers": {
    "zettelkasten": {
      "type": "http",
      "url": "http://localhost:8000/mcp"  // Changed!
    }
  }
}
```

### 2. Update Scripts/Automation

Replace any references to:
- `/sse` → `/mcp`
- `/messages/` → `/mcp`

### 3. Pull Latest Code

```bash
git pull origin feat/upgrade-mcp-sdk-1.22
```

### 4. Update Dependencies

```bash
# Sync dependencies with uv
uv sync

# Verify MCP SDK version
uv pip show mcp  # Should show 1.22.0
```

### 5. Restart Server

```bash
# Stop old server
# Start new server
uv run python -m zettelkasten_mcp --transport http
```

### 6. For Docker Users

```bash
# Rebuild image with new code
cd docker
docker compose down
docker compose build --no-cache
docker compose up -d

# Verify container is running
docker compose ps
docker logs zettelkasten-mcp-http
```

---

## Testing

After migration, verify:

- [ ] Health endpoint works: `curl http://localhost:8000/health`
  - Should return: `{"status": "healthy", "service": "zettelkasten-mcp", "transport": "streamable-http"}`
- [ ] MCP endpoint accepts POST: `curl -X POST http://localhost:8000/mcp -H "Content-Type: application/json" -d '{}'`
  - Should return: `200 OK` (not 404, not 405)
- [ ] Zed connects successfully (no timeout)
- [ ] All tools work via HTTP transport
- [ ] STDIO transport still works (if used)

See [Phase 4 Testing Documentation](.ai/plans/phases/streamable-http-implementation.phase-4.md) for detailed tests.

---

## Rollback

If issues occur:

```bash
# Revert to previous version
git checkout main
uv sync

# Verify rollback
uv pip show mcp  # Should show 1.6.0
```

---

## FAQs

**Q: Do I need to update my tool code?**
A: No. Tool definitions are unchanged. Only HTTP transport affected.

**Q: Will STDIO transport still work?**
A: Yes. STDIO transport is completely unchanged.

**Q: Can I use both Legacy and Modern HTTP?**
A: No. Server only supports one HTTP transport at a time.

**Q: What if I'm using mcp-remote?**
A: Update URL from `/sse` to `/mcp`. All functionality remains the same.

**Q: Why did the upgrade fix the Zed 60-second timeout?**
A: Zed expects Modern Streamable HTTP protocol. The old Legacy HTTP+SSE caused protocol mismatch, leading to connection failures.

**Q: Do I need to change my Docker configuration?**
A: If using Docker, rebuild the image. The docker-compose.yaml has been updated with new Traefik routing for `/mcp`.

---

## Implementation Details

This upgrade was implemented across 5 phases:

1. **Phase 1:** Preparation & Analysis (2025-11-22)
2. **Phase 2:** Dependency Upgrade (2025-11-22)
3. **Phase 3:** Code Updates for Streamable HTTP (2025-11-22)
4. **Phase 4:** Testing & Validation (2025-11-22)
5. **Phase 5:** Docker & Deployment Updates (2025-11-23)

Total implementation time: ~6 hours

---

## References

- [MCP Specification (2025-03-26)](https://modelcontextprotocol.io/specification/2025-03-26)
- [MCP Python SDK Changelog](https://github.com/modelcontextprotocol/python-sdk/releases)
- [Implementation Plan](.ai/plans/STREAMABLE_HTTP_IMPLEMENTATION.md)
- [CHANGELOG](../../CHANGELOG.md)
